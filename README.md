# 🚁 FPV Interceptor - Система перехвата FPV видеосигналов 5.8 ГГц

## 📋 Описание

FPV Interceptor - это специализированное ПО для Raspberry Pi 4 Model B, предназначенное для перехвата и анализа FPV (First Person View) видеосигналов в диапазоне 5.8 ГГц (5725-6000 МГц). Система использует модуль RX5808 для приема сигналов и продвинутый анализ RSSI для обнаружения видеосигналов.

## 🎯 Основные возможности

- **📡 Сканирование частот**: Полное и непрерывное сканирование диапазона 5.8 ГГц
- **📊 Анализ RSSI**: Продвинутый анализ силы сигнала с сглаживанием и трендами
- **📹 Обнаружение видео**: Автоматическое обнаружение FPV видеосигналов
- **🎥 Захват видео**: Автоматический захват и сохранение видеопотоков
- **📈 Мониторинг**: Мониторинг конкретных частот в реальном времени
- **💾 Сохранение данных**: Автоматическое сохранение обнаруженных сигналов

## 🔧 Требования к оборудованию

### Основные компоненты:
- **Raspberry Pi 4 Model B** (рекомендуется 4GB RAM)
- **RX5808 5.8GHz Receiver Module**
- **USB Video DVR** (для захвата видео)
- **5.8GHz Антенна** (круговая поляризация)
- **Макетная плата** и соединительные провода
- **Блок питания** (5V, минимум 3A)

### Подключение:
```
RX5808 Pin    →    Raspberry Pi 4 Pin    →    Функция
─────────────────────────────────────────────────────────
GND           →    Pin 6 (GND)          →    Земля
+5V           →    Pin 2 (5V)            →    Питание
RSSI          →    Pin 26 (GPIO 7)       →    Сила сигнала
VIDEO         →    USB Video DVR Input   →    Аналоговый видео
A6.5M         →    Pin 19 (GPIO 10)      →    SPI MOSI
CH1           →    Pin 23 (GPIO 11)      →    SPI SCK
CH2           →    Pin 24 (GPIO 8)       →    SPI CS
ANT           →    Антенна 5.8 ГГц       →    Антенна

USB Video DVR →    Raspberry Pi USB     →    Цифровой видео
```

### **Важно - Схема обработки сигнала:**
```
FPV Дрон → Антенна → RX5808 → Аналоговый видео → USB Video DVR → Цифровой видео → Raspberry Pi
```

**RX5808 НЕ передает видео на Raspberry Pi напрямую!**
- RX5808 выдает **аналоговый** видеосигнал
- USB Video DVR **оцифровывает** аналоговый сигнал
- Raspberry Pi получает уже **цифровой** видеопоток

## 🚀 Установка и настройка

### 1. Клонирование и сборка:
```bash
git clone <repository-url>
cd fpv-interceptor
make install-deps
make setup-system
sudo reboot
```

### 2. Сборка программы:
```bash
make
```

### 3. Проверка оборудования:
```bash
make test-hardware
```

### 4. Запуск:
```bash
./fpv_interceptor.sh
```

## 📖 Использование

### Главное меню:
```
╔══════════════════════════════════════════════════════════════╗
║                    FPV Interceptor v1.0                      ║
║              Перехват FPV сигналов 5.8 ГГц                  ║
║                    Raspberry Pi 4 Model B                    ║
╠══════════════════════════════════════════════════════════════╣
║ 1. Полное сканирование диапазона (5725-6000 МГц)            ║
║ 2. Непрерывное сканирование                                 ║
║ 3. Сканирование диапазона                                  ║
║ 4. Мониторинг частоты                                       ║
║ 5. Показать обнаруженные сигналы                           ║
║ 6. Сохранить данные                                         ║
║ 7. Информация о системе                                     ║
║ 8. Тест оборудования                                        ║
║ 0. Выход                                                    ║
╚══════════════════════════════════════════════════════════════╝
```

### Режимы работы:

#### 1. Полное сканирование
Сканирует весь диапазон 5725-6000 МГц с анализом каждой частоты.

#### 2. Непрерывное сканирование
Непрерывно сканирует диапазон в фоновом режиме с автоматическим обнаружением сигналов.

#### 3. Сканирование диапазона
Позволяет указать произвольный диапазон частот для сканирования.

#### 4. Мониторинг частоты
Мониторинг конкретной частоты в реальном времени.

## 🔍 Алгоритмы обнаружения

### Анализ RSSI:
- **Сглаживание**: Усреднение значений RSSI для устранения шума
- **Тренд-анализ**: Анализ изменений силы сигнала во времени
- **Стабильность**: Оценка стабильности сигнала
- **Пороговая обработка**: Автоматическое определение наличия сигнала

### Обнаружение видеосигнала:
- **Анализ яркости**: Характерные уровни яркости FPV видео
- **Анализ контраста**: Распределение контраста в кадре
- **Анализ движения**: Обнаружение характерного движения FPV
- **Синхросигналы**: Анализ горизонтальной и вертикальной синхронизации

### Анализ FPV характеристик:
- **Периодичность**: Характерная периодичность FPV сигналов
- **Амплитудная модуляция**: Анализ глубины модуляции
- **Частотные характеристики**: Анализ изменений сигнала

## 📊 Выходные данные

### Обнаруженные сигналы:
```
┌─────────────┬─────────┬─────────┬─────────────────────┬─────────────────┐
│ Частота     │ RSSI    │ Видео   │ Время обнаружения   │ Видеофайл        │
├─────────────┼─────────┼─────────┼─────────────────────┼─────────────────┤
│ 5800        │ 75      │ Да      │ 1703123456789       │ video_5800.avi  │
│ 5840        │ 60      │ Нет     │ 1703123456790       │ Нет             │
└─────────────┴─────────┴─────────┴─────────────────────┴─────────────────┘
```

### Сохранение данных:
- **Текстовые файлы**: Список обнаруженных сигналов с метаданными
- **Видеофайлы**: Захваченные видеопотоки в формате AVI
- **Логи**: Детальные логи работы системы

## ⚙️ Конфигурация

### Основные параметры:
```c
#define FREQ_MIN        5725    // Минимальная частота (МГц)
#define FREQ_MAX        6000     // Максимальная частота (МГц)
#define RSSI_THRESHOLD  50      // Порог RSSI (%)
#define VIDEO_WIDTH     640     // Ширина видео
#define VIDEO_HEIGHT    480     // Высота видео
#define VIDEO_FPS       30      // FPS видео
```

### GPIO пины:
```c
#define CS_PIN          8       // Chip Select
#define MOSI_PIN        10      // MOSI
#define MISO_PIN        9       // MISO
#define SCK_PIN         11      // SCK
#define RSSI_PIN        7       // RSSI
```

## 🛠️ Технические детали

### Архитектура:
- **Модульная структура**: Разделение на независимые модули
- **Многопоточность**: Асинхронное сканирование и обработка
- **Обработка сигналов**: Корректное завершение по сигналам
- **Управление ресурсами**: Автоматическая очистка ресурсов

### Производительность:
- **Скорость сканирования**: ~1 МГц/сек
- **Задержка обнаружения**: <100 мс
- **Точность RSSI**: ±5%
- **Поддерживаемые форматы**: AVI, JPEG

## 🔧 Устранение неполадок

### Частые проблемы:

#### SPI не работает:
```bash
# Проверка SPI
ls /dev/spi*
# Включение SPI
echo "dtparam=spi=on" | sudo tee -a /boot/firmware/config.txt
```

#### Видео не захватывается:
```bash
# Проверка видеоустройств
ls /dev/video*
# Проверка USB устройств
lsusb
```

#### Слабый сигнал:
- Проверьте подключение антенны
- Убедитесь в правильной поляризации
- Проверьте заземление

### Отладка:
```bash
# Сборка отладочной версии
make debug

# Проверка оборудования
make test-hardware

# Логи системы
journalctl -u fpv-interceptor
```

## 📚 API документация

### Основные функции:

#### RX5808 Driver:
```c
int rx5808_init(void);
int rx5808_set_frequency(uint16_t frequency);
uint8_t rx5808_read_rssi(void);
```

#### RSSI Analyzer:
```c
uint8_t analyze_rssi(uint16_t frequency);
uint8_t detect_video_signal(uint16_t frequency);
void smooth_rssi(uint16_t frequency, uint8_t rssi);
```

#### Video Detector:
```c
int init_video_capture(void);
int capture_video_frame(uint16_t frequency);
void save_video_stream(uint16_t frequency);
```

#### Frequency Scanner:
```c
int scan_frequency_range(void);
int scan_single_frequency(uint16_t frequency);
void scan_continuous(void);
```

## 🤝 Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой функции
3. Внесите изменения
4. Создайте Pull Request

## 📄 Лицензия

Этот проект распространяется под лицензией MIT. См. файл LICENSE для подробностей.

## ⚠️ Правовая информация

Данное ПО предназначено только для образовательных и исследовательских целей. Пользователи несут полную ответственность за соблюдение местного законодательства при использовании системы.

## 📞 Поддержка

- **Issues**: Создайте issue в репозитории
- **Документация**: См. файлы в директории docs/
- **Примеры**: См. файлы в директории examples/

---

**🎯 FPV Interceptor - Профессиональный инструмент для анализа FPV сигналов!**

